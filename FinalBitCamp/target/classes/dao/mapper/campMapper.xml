<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.CampDao">

<insert id="insertCamp" parameterType="camp">

	insert into camp values(
	#{campId}, #{campName}, #{sellerId}, #{campPhone}, #{campAddr}, #{campOwner}, #{status}, #{joinDate}, #{stopDate}, #{latitude}, #{longitude}
	)

</insert>

<select id="selectOne" parameterType="int" resultType="camp">

	select * from camp where campId=#{campId}

</select>

<select id="getStock" parameterType="String" resultType="java.util.HashMap">

	select count(*), s.siteId, s.campSiteStock, bs.stayDay from bookedsite bs join site s where s.siteId  = bs.siteId and stayDay = #{chkIn} group by s.siteId;

</select>

<select id="selectSearch" resultType="java.util.HashMap" parameterType="java.util.HashMap">

	<if test="type==0">
	select p.file, c.campId, c.latitude, c.longitude, c.campName, s.campSiteName, c.campAddr, c.campPhone, s.busyWkndPrice as price, s.siteId from camp c join site s join picture p where 1=0 
	<if test="campName!=null">or c.campId = s.campId and c.campId = p.campId and c.campName like '%${campName}%' and s.campPerson like '%${campPerson}%'</if>
	<if test="campAddr!=null">or c.campId = s.campId and c.campId = p.campId and c.campAddr like '%${campAddr}%' and s.campPerson like '%${campPerson}%'</if>	
	<choose>
		<when test="campName==null and campAddr==null">
			or 1=1 and c.campId = s.campId and c.campId = p.campId and s.campPerson like '%${campPerson}%'
		</when>
	</choose>
	</if>
	<if test="type==1">
	select p.file, c.campId, c.latitude, c.longitude, c.campName, s.campSiteName, c.campAddr, c.campPhone, s.busyDayPrice as price, s.siteId from camp c join site s join picture p where 1=0 
	<if test="campName!=null">or c.campId = s.campId and c.campId = p.campId and c.campName like '%${campName}%' and s.campPerson like '%${campPerson}%'</if>
	<if test="campAddr!=null">or c.campId = s.campId and c.campId = p.campId and c.campAddr like '%${campAddr}%' and s.campPerson like '%${campPerson}%'</if>	
	<choose>
		<when test="campName==null and campAddr==null">
			or 1=1 and c.campId = s.campId and c.campId = p.campId and s.campPerson like '%${campPerson}%'
		</when>
	</choose>
	</if>
	<if test="type==2">
	select p.file, c.campId, c.latitude, c.longitude, c.campName, s.campSiteName, c.campAddr, c.campPhone, s.wkndPrice as price, s.siteId from camp c join site s join picture p where 1=0 
	<if test="campName!=null">or c.campId = s.campId and c.campId = p.campId and c.campName like '%${campName}%' and s.campPerson like '%${campPerson}%'</if>
	<if test="campAddr!=null">or c.campId = s.campId and c.campId = p.campId and c.campAddr like '%${campAddr}%' and s.campPerson like '%${campPerson}%'</if>	
	<choose>
		<when test="campName==null and campAddr==null">
			or 1=1 and c.campId = s.campId and c.campId = p.campId and s.campPerson like '%${campPerson}%'
		</when>
	</choose>
	</if>
	<if test="type==3">
	select p.file, c.campId, c.latitude, c.longitude, c.campName, s.campSiteName, c.campAddr, c.campPhone, s.dayPrice as price, s.siteId from camp c join site s join picture p where 1=0 
	<if test="campName!=null">or c.campId = s.campId and c.campId = p.campId and c.campName like '%${campName}%' and s.campPerson like '%${campPerson}%'</if>
	<if test="campAddr!=null">or c.campId = s.campId and c.campId = p.campId and c.campAddr like '%${campAddr}%' and s.campPerson like '%${campPerson}%'</if>	
	<choose>
		<when test="campName==null and campAddr==null">
			or 1=1 and c.campId = s.campId and and c.campId = p.campId and s.campPerson like '%${campPerson}%'
		</when>
	</choose>
	</if>
	<if test="order!=null">order by ${order} </if>
	limit #{skip}, #{qty}
</select>

<select id="selectPic" parameterType="int" resultType="picture">

	select * from picture where campId=#{campId}

</select>

<select id="selectLocation" resultType="java.util.HashMap">

	select latitude, longitude, campName from camp

</select>

<select id="selectCampRate" parameterType="int" resultType="java.util.HashMap">

	select avg(rate), campId from campreview where campId = #{campId}
	
</select>

</mapper>